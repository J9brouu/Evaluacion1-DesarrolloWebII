<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Inventario de Juegos — Bienvenido</title>

        <!-- Google Font -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
        <!-- Bootstrap 5 CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <!-- Bootstrap Icons (opcional) -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/styles.css">
    </head>
    <body class="bg-gradient">

        <header th:replace="fragments/navbar :: navbar"></header>

        <header class="py-5">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-7 text-white">
                        <h1 class="display-5 fw-bold black">Bienvenido al Inventario de Juegos</h1>
                        <div sec:authorize="isAuthenticated()" class="mt-3">
                            <div class="alert alert-success py-2" role="alert">
                                <strong>Hola, <span sec:authentication="name"></span>!</strong>
                                <span class="ms-2">Bienvenido — explora los juegos disponibles abajo.</span>
                            </div>
                        </div>

                        <!-- Mensaje para invitados (sin sesión) -->
                        <div sec:authorize="isAnonymous()" class="mt-3">
                            <div class="alert alert-primary py-3" role="alert">
                                <h5 class="mb-1">¡Bienvenido a GameInventory!</h5>
                                <p class="mb-0">Regístrate o inicia sesión para comprar juegos y guardar tus pedidos.</p>
                            </div>
                            <div class="mt-3">
                                <a href="/login" class="btn btn-primary btn-lg shadow me-2">Iniciar sesión</a>        
                            </div>
                        </div>
                        <div sec:authorize="isAuthenticated()" class="col-lg-7 d-flex gap-2">
                            <a sec:authorize="hasRole('ADMIN')" href="/form-crear" class="btn btn-primary btn-lg shadow">Agregar juego <i class="bi bi-plus-circle ms-2"></i></a>
                            <a href="#inventario" class="btn btn-outline-black btn-lg shadow">Ver inventario</a>
                        </div>
                    </div>
                    <div class="col-lg-5 mt-4 mt-lg-0">
                        <div class="card glass p-3 shadow-lg">
                            <img src="/assets/libraryofgames.png" alt="juegos" class="img-fluid rounded">
                            <div class="pt-3">
                                <h5 class="mb-0 black">Lo que buscas en un solo lugar</h5>
                                <small class="text-muted">Rápido, sencillo y visual.</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <main class="py-5" >
            <div class="container" >
                <!-- Estadísticas rápidas (estáticas) -->
                <div class="row g-4 mb-4">
                    <div class="col-md-3">
                        <div class="card stat-card p-3 text-center">
                            <h2 class="mb-0 black" th:text="${totalJuegos}">0</h2>
                            <small class="text-muted">Total de juegos</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card p-3 text-center">
                            <h2 class="mb-0 black" th:text="${totalGeneros}">0</h2>
                            <small class="text-muted">Géneros</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card p-3 text-center">
                            <h2 class="mb-0 black" th:text="${totalPlataformas}">0</h2>
                            <small class="text-muted">Plataformas</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card stat-card p-3 text-center">
                            <h2 class="mb-0 black" th:text="${totalStock}">0</h2>
                            <small class="text-muted">En stock</small>
                        </div>
                    </div>
                </div>
                <div  sec:authorize="isAuthenticated()">
                <section id="inventario">
                    <div class="card shadow-sm mb-4">
                        <div class="card-body">
                            <h5 class="card-title">Últimos añadidos</h5>
                            <div class="table-responsive">
                              <table class="table table-hover align-middle">
                                <thead class="table-light">
                                  <tr>
                                    <th>Imagen</th>
                                    <th>Juego</th>
                                    <th>Género</th>
                                    <th>Plataforma</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Acciones</th>
                                  </tr>
                                </thead>
                                <tbody>
                                  <tr th:each="juego : ${juegos}">
                                    <td>
                                      <img th:src="@{/assets/libraryofgames.png}" alt="portada"
                                           style="width:48px;height:48px;object-fit:cover;border-radius:6px;">
                                    </td>
                                    <td th:text="${juego.titulo}">Título</td>
                                    <td th:text="${juego.genero}">Género</td>
                                    <td th:text="${juego.plataforma}">Plataforma</td>
                                    <td th:text="${juego.precio}">Precio</td>
                                    <td>
                                      <span th:text="${juego.stock}"
                                          th:class="${juego.stock &lt; 5 ? 'badge bg-warning text-dark' : 'badge bg-success'}">0</span>
                                    </td>
                                                                        <td>
                                                                            <!-- Ver siempre visible -->
                                                                            <a th:href="@{/juegos/{id}(id=${juego.id})}" class="btn btn-sm btn-outline-primary">Ver</a>

                                                                            <!-- Acciones para ADMIN: Editar + Eliminar -->
                                                                            <span sec:authorize="hasRole('ADMIN')">
                                                                                <a th:href="@{/form-editar(id=${juego.id})}" class="btn btn-sm btn-outline-secondary ms-1">Editar</a>

                                                                                <form th:action="@{/juegos/eliminar/{id}(id=${juego.id})}" method="post" class="d-inline ms-1"
                                                                                      th:onsubmit="return confirm('Eliminar este juego?');">
                                                                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf != null}" />
                                                                                    <button type="submit" class="btn btn-sm btn-outline-danger">Eliminar</button>
                                                                                </form>
                                                                            </span>

                                                                            <!-- Acciones para USER/USUARIO: Comprar -->
                                                                            <span sec:authorize="hasRole('USER')">
                                                                                <a th:href="@{/pedidos/crear(juegoId=${juego.id})}" class="btn btn-sm btn-success ms-1">Comprar</a>
                                                                            </span>
                                                                        </td>
                                  </tr>
                                </tbody>
                              </table>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            </div>
        </main>

       <div th:replace="fragments/footer :: footer"></div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</html>
